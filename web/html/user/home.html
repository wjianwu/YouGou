<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>用户主页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Java社区">
    <meta name="description" content="YouGou社区给你提供强大的知识库">
    <link rel="stylesheet" href="../../res/layui/css/layui.css">
    <link rel="stylesheet" href="../../res/css/global.css">
    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../res/layui/layui.js"></script>
    <script src="../../js/general.js"></script>
</head>
<body style="margin-top: 65px;">

<div class="fly-header layui-bg-black">
    <div class="layui-container">
        <a class="fly-logo" href="/html/index-2.html">
            <img src="../../res/images/logo.png" alt="layui">
        </a>
        <!--<ul class="layui-nav fly-nav layui-hide-xs">
            <li class="layui-nav-item layui-this">
                <a href="/html/index-2.html"><i class="iconfont icon-jiaoliu"></i>交流</a>
            </li>
            <li class="layui-nav-item">
                <a href="#"><i class="iconfont icon-iconmingxinganli"></i>案例</a>
            </li>
            <li class="layui-nav-item">
                <a href="#" target="_blank"><i class="iconfont icon-ui"></i>框架</a>
            </li>
        </ul>-->
        <ul class="layui-nav fly-nav-user">
            <!-- 登入后的状态 -->
            <li class="layui-nav-item">
                <a class="fly-nav-avatar" href="javascript:void(0)">
                    <cite id="citeText" class="layui-hide-xs">游客</cite>
                    <i class="iconfont icon-renzheng layui-hide-xs" title="认证信息：layui 作者"></i>
                    <!--<i class="layui-badge fly-badge-vip layui-hide-xs">VIP3</i>-->
                    <img id="headUrl" src="https://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg">
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="../user/set.html"><i class="layui-icon">&#xe620;</i>基本设置</a></dd>
                    <dd><a href="../user/message.html"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a>
                    </dd>
                    <dd><a href="../user/home.html" id="href1"><i class="layui-icon" style="margin-left: 2px; font-size: 22px;">&#xe68e;</i>我的主页</a>
                    </dd>
                    <hr style="margin: 5px 0;">
                    <dd><a href="javascript:void(0)" onclick="logOut()" style="text-align: center;">退出</a></dd>
                </dl>
            </li>
        </ul>
    </div>
</div>

<div class="fly-home fly-panel">
    <img id="bigHeadUrl" src="https://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg">
    <i class="iconfont icon-renzheng" title="Fly社区认证"></i>
    <h1>
        <i id="citeText2"></i>
        <i id="sex" class="iconfont"></i>
        <i class="layui-badge fly-badge-vip">VIP3</i>
        <!--
        <span style="color:#c00;">（管理员）</span>
        <span style="color:#5FB878;">（社区之光）</span>
        <span>（该号已被封）</span>
        -->
    </h1>

    <p style="padding: 10px 0; color: #5FB878;">认证信息：layui 作者</p>

    <p class="fly-home-info">
        <span style="color: #FF7200;" id="rank"></span>
        <i class="iconfont icon-shijian"></i><span id="create_on"></span>
        <i class="iconfont icon-chengshi"></i><span>来自杭州</span>
    </p>

    <p id="L_sign" class="fly-home-sign"></p>

    <div class="fly-sns" data-user="">
        <a href="javascript:void(0)" id="made" class="layui-btn layui-btn-primary fly-imActive" data-type="addFriend">加为好友</a>
        <a href="javascript:void(0)" class="layui-btn layui-btn-normal fly-imActive" data-type="chat">发起会话</a>
    </div>
    <script>
        $("#made").click(function () {
            $.ajax({
                type:"POST",
                url:"",
                dataType:"json",
                success:function (data) {
                    if(data.status == "ok"){
                        layer.msg("好友申请已发送",{icon:6});
                    }else {
                        layer.msg("发送失败",{icon:4});
                    }
                }
            })
        })
    </script>

</div>

<div class="layui-container">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md6 fly-home-jie">
            <div class="fly-panel">
                <h3 class="fly-panel-title" id="Username"></h3>
                <ul class="jie-row" id="showDiv">
                </ul>
            </div>
        </div>

        <div class="layui-col-md6 fly-home-da">
            <div class="fly-panel">
                <h3 class="fly-panel-title" id="Username1"></h3>
                <ul class="home-jieda" id="home-jieda">
                    <li>
                        <p>
                            <span>1分钟前</span>
                            在<a href="" target="_blank">tips能同时渲染多个吗?</a>中回答：
                        </p>
                        <div class="home-dacontent">
                            尝试给layer.photos加上这个属性试试：
                            <pre>full: true</pre>
                            文档没有提及
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="fly-footer">
    <p>
        <a href="#" target="_blank">YouGou社区</a> 2018 &copy;
        <a href="#" target="_blank">文建武 出品(仅个人使用)</a>
    </p>
    <p>
        <a href="#" target="_blank">群拍计划</a>
        <a href="#" target="_blank">欢迎加入</a>
        <a href="#" target="_blank">微信公众号</a>
    </p>
</div>

<script>
    layui.cache.page = 'user';
    layui.cache.user = {
        username: '游客'
        , uid: -1
        , avatar: '../../res/images/avatar/00.jpg'
        , experience: 83
        , sex: '男'
    };
    layui.config({
        version: "3.0.0"
        , base: '../../res/mods/'
    }).extend({
        fly: 'index'
    }).use('fly');
    $(function () {
        var userId = getUrlParam("userId");
        $.ajax({
            type: "POST",
            url: "/show",
            dataType: "json",
            success: function (data) {
                $("#citeText").text(data.nickname + "(" + data.username + ")");
                $("#headUrl").attr("src", data.headUrl);
                $("#href1").attr("href","../user/home.html?userId="+data.id);
                $("#Username").text(data.nickname + "(" + data.username + ")"+"最近的发表：");
                $("#Username1").text(data.nickname + "(" + data.username + ")"+"最近的发表：");
            }

        });
        $.ajax({
            type: "POST",
            url: "/showUser?userId="+userId,
            dataType: "json",
            success: function (data) {
                $("#citeText2").text(data.nickname + "(" + data.username + ")");
                $("#bigHeadUrl").attr("src", data.headUrl);
                $("#L_sign").text(data.signature);
                $("#create_on").text(new Date(parseInt(data.createOn)).toLocaleString().replace(/:\d{1,2}$/,' '));
                $("#rank").text(data.amount + "积分点");
                if(data.sex == "男"){
                    $("#sex").addClass("icon-nan");
                }else {
                    $("#sex").addClass("icon-nv");
                }
            }
        });
        /*显示已发表的*/
        $.ajax({
            type:"POST",
            url:"/showTopic",
            dataType:"json",
            success:function (data) {
                $("#topicCount").text(data.length);
                var uls1 = "<ul class=\"mine-view jie-row\">";
                var bod = "";
                for(var i = data.length-1; i>=0; i--){
                    var lis1 = "<li><a class=\"jie-title\" href=\"../jie/detail.html?topic="+data[i].id+"\">";
                    var title = data[i].title + "</a><i>";
                    var tim = new Date(parseInt(data[i].createOn)).toLocaleString().replace(/:\d{1,2}$/,' ');
                    var al = "</i><a class=\"mine-edit\" href=\"#\">编辑</a><em>";
                    if(data[i].hits == null){ data[i].hits = 0;}
                    if(data[i].replyCount == null){ data[i].replyCount = 0;}
                    var rep = data[i].hits+"阅/" + data[i].replyCount+"回复</em></li>";
                    bod = bod + lis1 +title + tim + al + rep;
                }
                var uls2 = "</ul>";
                $("#showDiv").html(uls1 + bod + uls2);
            }
        });
        /*显示最近的评论*/
        $.ajax({
            type:"POST",
            url:"/showReply?userId="+userId,
            dataType:"json",
            success:function (data) {
                var st = '';
                for (var i=0;i<data.length;i++){
                    st = st + '<li>\n' +
                        '<p>\n' +
                        '<span>'+new Date(parseInt(data.createOn)).toLocaleString().replace(/:\d{1,2}$/,' ')+'前</span>\n' +
                        '在<a href="" target="_blank">'+data[i].topicId+'</a>中评论：\n' +
                        '</p>\n' +
                        '<div class="home-dacontent">'+data[i].comment+'</div>\n' +
                        '</li>';
                }
                $("#home-jieda").html(st);
            }
        })
    })
</script>

</body>
</html>